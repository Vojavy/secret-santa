# Техническое задание: Веб-приложение "Secret Santa"

## Содержание
1. [Функциональные требования](#функциональные-требования)
2. [Нефункциональные требования](#нефункциональные-требования)
3. [Архитектурные требования](#архитектурные-требования)

## Функциональные требования

| ID | Категория | Название функции | Описание |
|---|---|---|---|
| **F.1** | **АУТЕНТИФИКАЦИЯ И АВТОРИЗАЦИЯ** | | |
| F.1.1 | Регистрация | Регистрация пользователей | Система должна позволять регистрацию новых пользователей с обязательными полями: логин, email, пароль. Валидация email формата и уникальности логина. Подтверждение почты письмом |
| F.1.2 | Вход | Авторизация пользователей | Вход по логину и паролю с созданием JWT/OAuth2.0, генерацией CSRF токенов и автоматическим logout при неактивности (15 минут). |
| F.1.3 | Безопасность | Управление паролями | Смена пароля с подтверждением текущего пароля, logout с очисткой cookies (потенциально JWT). |
| **F.2** | **УПРАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯМИ** | | |
| F.2.1 | Профиль | Профиль пользователя | Просмотр и редактирование данных профиля (имя, фамилия, email, телефон, пол), загрузка и управление аватаром. |
| F.2.2 | Роли | Роли пользователей | Поддержка ролей "regular" и "admin" с контролем доступа на основе ролей. |
| **F.3** | **УПРАВЛЕНИЕ ИГРАМИ** | | |
| F.3.1 | Создание | Создание игр | Создание новой игры Secret Santa с полями: UUID, название, описание, количество игроков, дата окончания. Статусы: "pending", "running", "ended". |
| F.3.2 | Участие | Участие в играх | Подключение к игре по уникальному ID, автоматическое добавление в таблицу Players_Games, отслеживание статуса подарка. Ограничение подключения если нету мест. |
| F.3.3 | Управление | Управление игрой | Инстурменты управления комнаты и её настроек создателем, запуск игры создателем, автоматическая генерация случайных пар участников. |
| **F.4** | **СИСТЕМА ПАР (SECRET SANTA)** | | |
| F.4.1 | Генерация | Генерация пар | Алгоритм случайного распределения участников, создание записей в таблице Pairs со связью gifter_id с receiver_id. |
| F.4.2 | Управление | Управление парами | Просмотр назначенного получателя для дарителя, защита от просмотра чужих назначений. |
| F.4.3 | Вывод | Конец игры | После окончания игры, выводить данные о парах. |
| **F.5** | **СИСТЕМА ЖЕЛАНИЙ (WISHLIST)** | | |
| F.5.1 | CRUD | Управление списком желаний | Создание, редактирование и удаление элементов wishlist (название, описание, URL) с привязкой к пользователю. |
| F.5.2 | Просмотр | Просмотр желаний | Просмотр собственного списка желаний и списка желаний назначенного получателя. |
| **F.6** | **СИСТЕМА СООБЩЕНИЙ** | | |
| F.6.1 | Чат | Чат в лобби | Реал-тайм чат для участников игры через WebSocket соединение, история сообщений в рамках игры. |
| F.6.2 | Сообщения | ЛС | Личные сообщения между пользователей. |
| **F.7** | **АДМИНИСТРАТИВНАЯ ПАНЕЛЬ** | | |
| F.7.1 | Пользователи | Управление пользователями | CRUD операции для пользователей, просмотр всех зарегистрированных пользователей, изменение ролей. |
| F.7.2 | Игры | Управление играми | Просмотр всех игр в системе, CRUD операции для игр, управление парами участников. |
| F.7.3 | Контент | Управление контентом | Управление wishlist всех пользователей, модерация сообщений. |
| F.7.4 | Мониторинг | Мониторинг | Мониторинг ресурсов сервера, доступности и загруженности. |
| **F.8** | **РЕАЛ-ТАЙМ ФУНКЦИОНАЛЬНОСТЬ** | | |
| F.8.1 | WebSocket | WebSocket сервер | Установка WebSocket соединений на порту 9090, Ratchet библиотека, автоматическое переподключение. |
| F.8.2 | Обновления | Живые обновления | Уведомления о подключении/отключении участников, реал-тайм обновление списка игроков, мгновенный чат. |
| **F.9** | **УВЕДОМЛЕНИЯ** | | |
| F.9.1 | Уведомления | Уведомления на сайте | Уведомления об играх в отдельной вкладке. |
| F.9.2 | Письма | Уведомления на почту | Уведомления об в письмами на почту. |
| F.9.3 | Письма | Рассылки на почту | Рассылки на почту для вовлечения пользователей. |

## Нефункциональные требования

| ID | Категория | Требование | Описание | Целевое значение |
|---|---|---|---|---|
| **NF.1** | **ПРОИЗВОДИТЕЛЬНОСТЬ** | | | |
| NF.1.1 | Время отклика | Время обработки API запросов | Spring Boot монолит обрабатывать запросы максимально быстро | ≤ 500 миллисекунд |
| NF.1.2 | Загрузка | Время загрузки страниц | React приложение с Tailwind CSS должно загружаться быстро | ≤ 2 секунды |
| NF.1.3 | WebSocket | Установка WebSocket соединений | Spring WebSocket соединения должны устанавливаться мгновенно | ≤ 500 миллисекунд |
| NF.1.4 | Пропускная способность | Одновременные пользователи | Система должна поддерживать высокую нагрузку через Kubernetes масштабирование | До 1000+ пользователей |
| **NF.2** | **НАДЕЖНОСТЬ** | | | |
| NF.2.1 | Доступность | Время безотказной работы | Kubernetes кластер должен обеспечивать высокую доступность с репликацией | ≥ 99.9% |
| NF.2.2 | Восстановление | Fault tolerance | Автоматическое восстановление подов и сервисов через Kubernetes health checks | Автоматически |
| NF.2.3 | Обработка ошибок | Устойчивость к ошибкам | Spring Boot error handling, Circuit Breaker паттерн, детальное логирование | 100% покрытие |
| **NF.3** | **БЕЗОПАСНОСТЬ** | | | |
| NF.3.1 | Аутентификация | JWT токены | Stateless аутентификация через Spring Security с JWT токенами | JWT + refresh tokens |
| NF.3.2 | Аутентификация | OAuth2.0 | Stateless аутентификация через Spring Security с использованием стононних провайдеров | Auth tokens + refresh tokens |
| NF.3.3 | Авторизация | RBAC | Role-based access control на уровне методов и endpoints | Spring Security RBAC |
| NF.3.4 | Защита данных | Шифрование | BCrypt для паролей, TLS для транспорта, MongoDB field-level encryption | BCrypt + TLS 1.3 |
| **NF.4** | **МАСШТАБИРУЕМОСТЬ** | | | |
| NF.4.1 | Горизонтальная | Kubernetes автомасштабирование | Horizontal Pod Autoscaler (HPA) для автоматического масштабирования под нагрузкой | Auto-scaling |
| NF.4.2 | Архитектурная | Монолитная архитектура | Spring Boot монолит с stateless и масштабированием | Stateless Монолит |
| **NF.5** | **СОВМЕСТИМОСТЬ** | | | |
| NF.5.1 | Браузеры | Поддержка браузеров | Поддержка современных браузеров с Tailwind CSS совместимостью | Chrome 90+, Firefox 88+, Safari 14+. |
| NF.5.2 | Браузеры | Неподдерживаемые браузеры | Неподдерживаемые браузеры должны выводить сообщение "браузер не поддерживается" | Сообщением решим. |
| NF.5.3 | Платформы | Экономия | Kubernetes развертывание на 1 провайдере, потенциально на distrbyt.dev домене | 1 node host |
| NF.5.4 | Адаптивность | Responsive дизайн | Tailwind CSS utility-first подход для адаптивного дизайна | Tailwind breakpoints |
| **NF.6** | **УДОБСТВО ИСПОЛЬЗОВАНИЯ** | | | |
| NF.6.1 | Интерфейс | UI/UX с Tailwind | Современный интерфейс с Tailwind CSS, поддержка светлой и темной темы | Tailwind design system |
| NF.6.2 | Доступность | Accessibility | Semantic HTML, ARIA attributes, keyboard navigation, Tailwind accessibility utilities | WCAG 2.1 AA |
| **NF.7** | **СОПРОВОЖДЕНИЕ** | | | |
| NF.7.1 | Мониторинг | Observability | Логи и отображение статуса сервера через панель | Логи и статус панель |
| NF.7.2 | Развертывание | DevOps | Kubernetes CI/CD pipeline, GitOps, automated testing, blue-green deployment | mini DevOps |

## Архитектурные требования

| Компонент | Технология | Версия | Назначение |
|---|---|---|---|
| **Frontend** | React | 18.3.1+ | Клиентский интерфейс пользователя |
| **Frontend Router** | React Router DOM | 6.26.2+ | Маршрутизация на клиенте |
| **State Management** | React Context API / Redux Toolkit | - | Управление состоянием приложения |
| **HTTP Client** | Axios / Fetch API | - | Коммуникация с API |
| **UI Framework** | Tailwind CSS | 3.4+ | Utility-first CSS фреймворк |
| **UI Components** | САША РЕШИ | - | Доступные компоненты |
| **Backend** | Spring Boot | 3.2+ | Java framework для REST API |
| **Security** | Spring Security | 6.2+ | Аутентификация и авторизация |
| **Database** | MongoDB | 7.0+ | NoSQL документная база данных |
| **ODM** | Spring Data MongoDB | 4.2+ | Объектно-документное отображение |
| **WebSocket** | Spring WebSocket | - | Реал-тайм коммуникация |
| **Containerization** | Docker | 25+ | Контейнеризация приложений |
| **Orchestration** | k3s | 1.28+ | Оркестрация контейнеров |
| **Documentation** | Swagger | - | Документация |
| **Testing j** | Junit 5 | - | Тестирование |


## База данных - Схема MongoDB и требования

| Коллекция | Описание | Ключевые поля | Индексы | Ограничения |
|---|---|---|---|---|
| **users** | Пользователи системы | _id, login, email, passwordHash, firstName, lastName, phone, gender, role, createdAt | login, email | role: ['regular', 'admin'] |
| **games** | Игры Secret Santa | _id, name, description, budget, createdAt, endsAt, status, creatorId | _id, creatorId, status | status: ['pending', 'running', 'ended'] |
| **wishlists** | Список желаний пользователей | _id, name, description, url, userId, createdAt | _id, userId | - |
| **players** | Участники игр | _id, gameId, userId, isGifted, joinedAt | gameId, userId, compound(gameId, userId) | - |
| **pairs** | Пары даритель-получатель | _id, gameId, gifterId, receiverId, createdAt | gameId, gifterId, receiverId | - |
| **messages** | Сообщения в рамках игр | _id, gameId, userId, messageEncrypted, createdAt | gameId, userId, createdAt | - |
| **direct_messages** | Личные сообщения | _id, gameId, userId, messageEncrypted, createdAt | gameId, userId, createdAt | - |
| **logs** | Логирование | _id, timestamp, action | action | - |


## Kubernetes развертывание

| Ресурс | Тип | Описание | Реплики |
|---|---|---|---|
| **frontend-deployment** | Deployment | React приложение | 2-3 |
| **backend-service-deployment** | Deployment | Сервис аутентификации | 2 |
| **mongodb-statefulset** | StatefulSet | MongoDB кластер | 3 |
| **nginx-ingress** | Ingress | Входной контроллер | 2 |

## Метрики производительности

| Метрика | Целевое значение | Примечания |
|---|---|---|
| **Время отклика API** | ≤ 500мс | Spring Boot |
| **Время загрузки страницы** | ≤ 2с | React + Tailwind оптимизация |
| **Использование памяти** | ≤ 1GB/pod | JVM оптимизация |
| **CPU нагрузка** | ≤ 80% | В нормальных условиях |
| **MongoDB операции** | ≤ 100мс | Для CRUD операций |
| **WebSocket соединение** | ≤ 500мс установки | Spring WebSocket |
| **Одновременные пользователи** | 1000+ | Горизонтальное масштабирование |
| **Доступность сервисов** | 99.9% | Kubernetes health checks |

## Безопасность

| Аспект безопасности | Реализация | Примечания |
|---|---|---|
| **Аутентификация** | JWT токены + Spring Security | Stateless аутентификация |
| **Авторизация** | Role-based + Method-level security | @PreAuthorize аннотации |
| **Хеширование паролей** | BCrypt | Spring Security PasswordEncoder |
| **API Security** | OAuth 2.0 + OpenID Connect | Spring Security OAuth2 |
| **Transport Security** | TLS 1.3 | Kubernetes Ingress TLS |
| **Data Encryption** | MongoDB Field Level Encryption | Конфиденциальные данные |
| **CORS** | Spring WebMVC CORS | Настроенные origins |
| **Rate Limiting** | Spring Cloud  | API throttling |
| **Input Validation** | Spring Validation + Bean Validation | @Valid аннотации |
| **Security Headers** | Spring Security Headers | CSRF, XSS, HSTS |

## Развертывание

| Среда | Конфигурация | Примечания |
|---|---|---|
| **Development** | Docker-Compose / Docker Desktop | Локальная разработка |
| **Staging** | Kubernetes кластер | Тестовое окружение |
| **Production** | Managed Kubernetes (EKS/GKE/AKS) | Облачное развертывание |
| **Database** | MongoDB Atlas / Self-hosted | Managed или собственная MongoDB |
| **Monitoring** | хз | Метрики и мониторинг |
| **Logging** | хз | Централизованное логирование |
| **CI/CD** | GitHub Actions / GitLab CI | Автоматизация развертывания |
| **Container Registry** | Docker Hub / ECR / GCR | Хранение образов |
| **Secret Management** | Kubernetes Secrets / Vault | Управление секретами |

## Tailwind CSS конфигурация

| Аспект | Конфигурация | Описание |
|---|---|---|
| **Дизайн-система** | tailwind.config.js | Кастомные цвета, шрифты, размеры |
| **Темы** | CSS Variables + Tailwind | Светлая и темная тема |
| **Responsive** | Mobile-first | sm, md, lg, xl, 2xl breakpoints |
| **Компоненты** | @apply директивы | Переиспользуемые стили |
| **Оптимизация** | PurgeCSS | Удаление неиспользуемых стилей |
| **Плагины** | Tailwind UI, Forms, Typography | Дополнительные утилиты |

## Spring Boot конфигурация

| Аспект | Технология | Описание |
|---|---|---|
| **Profiles** | application-{env}.yml | dev, staging, production |
| **Config Server** | Spring Cloud Config | Централизованная конфигурация |
| **Health Checks** | Spring Actuator | /actuator/health endpoint |
| **Metrics** | Micrometer + Prometheus | Метрики приложения |
| **Logging** | Logback + Structured Logging | JSON формат логов |
| **Caching** | Spring Cache + Redis | Кеширование данных |
| **Async Processing** | @Async + TaskExecutor | Асинхронные операции |
| **Validation** | Bean Validation (JSR-380) | Валидация входных данных |

---

**Дата создания:** 19 июля 2025  
**Версия:** 1.0  
**Автор:** Команда разработки Secret Santa  
**Статус проекта:** Завершен и готов к производству
