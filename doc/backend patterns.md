
# Backend Patterns & Code Style

| –†–∞–∑–¥–µ–ª                  | TL;DR / —á—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å                                                        |
| ----------------------- | ---------------------------------------------------------------------------- |
| **Packages**            | `com.yourorg.secretsanta.<feature>` ‚Äì –æ–¥–Ω–æ —Å–ª–æ–≤–æ; –µ—Å–ª–∏ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç ‚Üí –∞–∫—Ä–æ–Ω–∏–º. |
| **–ö–ª–∞—Å—Å—ã / –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** | `PascalCase`, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã c –ø—Ä–µ—Ñ–∏–∫—Å–æ–º **I** (`IEventService`).                |
| **–ú–µ—Ç–æ–¥—ã / –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** | `camelCase` ‚Äì `generateAssignments()`, `participantEmail`.                   |
| **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã**           | `UPPER_SNAKE_CASE` ‚Äì `DEFAULT_DRAW_DATE`.                                    |
| **DTO / Commands**      | `ParticipantDto`, `CreateEventRequest`, `AssignmentResponse`.                |
| **–ü–∞—Ç—Ç–µ—Ä–Ω—ã**            | Repository ‚Üí Service ‚Üí Controller, + Facade, Strategy, Builder.              |
| **–ë—É–ª–∏–Ω-–≥–µ—Ç—Ç–µ—Ä—ã**       | `isAnonymousDraw()`, `hasActiveEvent()`.                                     |
| **–°–ª–æ–∏**                | *domain* ‚ÜîÔ∏é *application* ‚ÜîÔ∏é *infrastructure* ‚ÜîÔ∏é *web*.                      |
| **–¢–µ—Å—Ç—ã**               | `*Test.java` –ø–æ–¥ `src/test/java`: unit / integration / slice.                |

---

## 1. Packages

```
com.yourorg.secretsanta
 ‚îú‚îÄ controllers    # Rest –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
 ‚îú‚îÄ ws             # Web Socket`—ã
 ‚îú‚îÄ services       # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –¥–µ–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ –Ω–∞ "users", "games" etc.
 ‚îú‚îÄ repositories   # —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ –±–¥, —Ç–∞–∫ –∂–µ –¥–∞–ª—å—à–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
 ‚îú‚îÄ models         # –≠–Ω—Ç–∏—Ç—ã, –º–æ–¥–µ–ª–∏, enum`s, –¥–∞–ª—å—à–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
 ‚îú‚îÄ dto            # –î–∞—Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –æ–±–∂–µ–∫—Ç, –¥–∞–ª—å—à–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
 ‚îú‚îÄ config         # Spring-–∫–æ–Ω—Ñ–∏–≥–∏ (CORS, security‚Ä¶)
 ‚îî‚îÄ common         # utils, exceptions
```

* –û–¥–Ω–æ —Å–ª–æ–≤–æ. –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ ‚Üí `evt`, `part`, `assign`. –ò–∑–±–µ–≥–∞–µ–º –∫–∞—Å–∫–∞–¥–∞ `service.service` –∏–ª–∏ ¬´tech-label¬ª –ø–∞–∫–µ—Ç–æ–≤ –≤—Ä–æ–¥–µ `impl`, `util` –≤–Ω—É—Ç—Ä—å –±–∏–∑–Ω–µ—Å-–∫–æ–¥–∞.
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–æ–º –∂–µ –ø–∞–∫–µ—Ç–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
* –ï—Å–ª–∏ –∫–∞–∫–æ–≥–æ —Ç–æ –ø–∞–∫–µ—Ç–∞ –Ω–µ—Ç—É –≤—ã—à–µ –≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–π—Ç–µ)))).
* Dev-profile –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–º –≤ **`application-dev.yml`**; –Ω–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ ‚Äì —Ç–æ–ª—å–∫–æ placeholder-—ã –ø–æ–¥ `${ENV_VAR}`.&#x20;

---

## 2. –ö–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

| –ü—Ä–∏–º–µ—Ä                           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                                    |
| -------------------------------- | --------------------------------------------------------------------------------------------- |
| `EventController`                | REST-—Å–ª–æ–π (`@RestController`).                                                                |
| `IEventService` / `EventService` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ—Ç–¥–µ–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.                                                |
| `GiftAssignmentRepository`       | JPA / Mongo access.                                                                           |
| `EventFacade`                    | ¬´–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞¬ª –¥–ª—è –≤—Å–µ–≥–æ, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è Event: —Å–æ–∑–¥–∞–ª–∏ ‚Üí –¥–æ–±–∞–≤–∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Üí –∑–∞–ø—É—Å—Ç–∏–ª–∏ draw. |

> **Builder / Parameter Object** ‚Äì –ø—Ä–∏ > 3-—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∏–ª–∏ –Ω–∞–ª–∏—á–∏–∏ boolean-—Ñ–ª–∞–≥–æ–≤.
> `Event.builder().name("Office 2025").budget(20).anonymous(true).build();`

---

## 3. –ú–µ—Ç–æ–¥—ã, –ø–æ–ª—è, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```java
public class EventService implements IEventService {

    private final GiftAssignmentRepository assignmentRepo;

    public List<AssignmentDto> generateAssignments(String eventId,
                                                   List<String> participantIds,
                                                   boolean anonymous) { ... }

    private static final int MAX_RETRY = 5;
}
```

* –ë—É–ª–∏–Ω-–≥–µ—Ç—Ç–µ—Ä: `isAnonymous()`, `hasBudgetLimit()`.
* **–ù–∏–∫–æ–≥–¥–∞**: `isNotSomething()`.

---

## 4. DTO / Command-–æ–±—ä–µ–∫—Ç—ã

| –¢–∏–ø          | –ü—Ä–∏–º–µ—Ä               | –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–≥–¥–∞‚Ä¶                            |
| ------------ | -------------------- | -------------------------------------------- |
| **Request**  | `CreateEventRequest` | –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ Controller.                     |
| **Response** | `AssignmentResponse` | –Ω–∞—Ä—É–∂—É –∏–∑ Controller.                        |
| **Dto**      | `ParticipantDto`     | –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è –∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥ –∫ —Ñ—Ä–æ–Ω—Ç—É. |

> –õ–æ–º–∞–µ–º –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ DTO, –Ω–µ —Ç–∞—Å–∫–∞–µ–º Entity –Ω–∞—Ä—É–∂—É.

---

## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

| –ü–∞—Ç—Ç–µ—Ä–Ω                        | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º                                                    | –ö–æ—Ä–æ—Ç–∫–æ                           |
| ------------------------------ | ----------------------------------------------------------------- | --------------------------------- |
| **Repository**                 | `*Repository`                                                     | –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ë–î.                    |
| **Service**                    | `*Service`                                                        | —á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞.             |
| **Controller**                 | `*Controller`                                                     | HTTP-–ø—Ä–∏—ë–º–Ω–∏–∫, 0 –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.   |
| **Facade**                     | `EventFacade`, `UserFacade`                                       | –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—É—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—É. |
| **Strategy**                   | `DrawStrategy` (+ `ClassicDrawStrategy`, `AvoidanceDrawStrategy`) | —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∂–µ—Ä–µ–±—å—ë–≤–∫–∏.      |
| **Builder / Parameter Object** | `Event.Builder`, `AssignmentParams`                               | –¥–ª–∏–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã.             |
| **Enum** | `Roles.<type>`, `GameStatuses.<type>`                               | –õ—é–±—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è.             |

---

## 6. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   DTO/Command   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Controller  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Service  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚ñ≤                        ‚îÇ Entity
            ‚îÇ                        ‚ñº
        HTTP‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ    Repo <‚îÄJPA/Mng‚îÄ ‚îÇRepository ‚îÇ
            ‚ñº                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        Web/REST            Infrastructure (DB)
```

* –í–Ω–µ—à–Ω–∏–µ —Å–ª–æ–∏ **–Ω–µ** –∑–Ω–∞—é—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö: Controller –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ Service / Facade.
* `UserServiceFacade`  ‚Äì —Ñ–∞—Å–∞–¥, –∞ –Ω–µ ¬´–∂–∏—Ä–Ω—ã–π¬ª —Å–µ—Ä–≤–∏—Å: –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç `UserProfileService`, `UserNotificationService` –∏ –ø—Ä–æ—á–µ–µ.&#x20;

---

## 7. –ë—É–ª–∏–Ω-–≥–µ—Ç—Ç–µ—Ä—ã

```java
public class Assignment {
    private boolean anonymousDraw;

    public boolean isAnonymousDraw() {          // ‚úî
        return anonymousDraw;
    }
}
```

*–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–µ—Ñ–∏–∫—Å **is/has** ‚Üí —á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥.*
`isNotChotoTam()` ‚Äî üö´, –º–æ–≤–µ—Ç–æ–Ω.&#x20;

---

## 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢–∏–ø                  | –ì–¥–µ                                                     | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã / –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏                                           |
| -------------------- | ------------------------------------------------------- | ----------------------------------------------------------------- |
| **Unit-test**        | `src/test/java`                                         | JUnit 5, Mockito, AssertJ. –ò–º–µ–Ω–∞: `EventServiceTest`.             |
| **Slice-test**       | `@WebMvcTest`, `@DataMongoTest`                         | –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–æ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.                                      |
| **Integration-test** | `@SpringBootTest(classes = TestContainersConfig.class)` | –ø–æ–¥–Ω–∏–º–∞–µ–º Mongo/Postgres –≤ Testcontainers, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É. |

–ù–µ–π–º–∏–Ω–≥: `*Test.java` (unit & slice) / `*IT.java` (integration) –ø–æ –∂–µ–ª–∞–Ω–∏—é –∫–æ–º–∞–Ω–¥—ã.
–ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI –ø–µ—Ä–µ–¥ `mvn package`.

---

## 9. application-dev.yml

```yaml
spring:
  profiles:
    active: dev

mongo:
  uri: ${MONGO_URI}        # –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ .env –∏–ª–∏ docker-compose
```

* –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ ‚Äì *–ø—Ä–æ–∫–∏–Ω—É—Ç—å* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Spring —á–µ—Ä–µ–∑ `${‚Ä¶}`.
* –ù–µ –¥—É–±–ª–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ production, –Ω–µ —Ö—Ä–∞–Ω–∏–º —Å–µ–∫—Ä–µ—Ç—ã.

---

## 10. TL;DR

> **‚Äú–û–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –æ–¥–Ω–æ —Å–ª–æ–≤–æ, –æ–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω‚Äù**
> –°–æ–±–ª—é–¥–∞–µ–º —á–∏—Ç–∞–µ–º—ã–µ –∏–º–µ–Ω–∞, —á—ë—Ç–∫–æ –æ—Ç–¥–µ–ª—è–µ–º —Å–ª–æ–∏, –Ω–µ —Å–º–µ—à–∏–≤–∞–µ–º HTTP, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –ë–î. –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Ç–¥–µ–ª—å–Ω–æ, –∞ –ø–æ—Ç–æ–º —Ü–µ–ª–∏–∫–æ–º.

---
